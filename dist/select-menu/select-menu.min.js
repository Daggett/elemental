angular.module("elemental.select-menu",["ngResource"]).directive("elSelectMenu",["$compile","$parse",function(a,b){function c(a){var b,c=typeof a;return"object"==c&&null!==a?"function"==typeof(b=a.$$hashKey)?b=a.$$hashKey():void 0===b&&(b=a.$$hashKey=e()):b=a,c+":"+b}function d(a){j(a,this.put,this)}function e(){return k++}var f=angular.noop,g=angular.isDefined,h=angular.isUndefined,i=angular.element,j=angular.forEach;d.prototype={put:function(a,b){this[c(a)]=b},get:function(a){return this[c(a)]},remove:function(a){var b=this[a=c(a)];return delete this[a],b}};var k=0,l=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,m={$setViewValue:f};return{restrict:"A",require:["elSelectMenu","?ngModel"],controller:["$element","$scope","$attrs",function(a,b,d){var e,g,h=this,i={},j=m;h.databound=d.ngModel,h.init=function(a,b,c){j=a,e=b,g=c},h.addOption=function(b){assertNotHasOwnProperty(b,'"option value"'),i[b]=!0,j.$viewValue==b&&(a.val(b),g.parent()&&g.remove())},h.removeOption=function(a){this.hasOption(a)&&(delete i[a],j.$viewValue==a&&this.renderUnknownOption(a))},h.renderUnknownOption=function(b){var d="? "+c(b)+" ?";g.val(d),a.prepend(g),a.val(d),g.prop("selected",!0)},h.hasOption=function(a){return i.hasOwnProperty(a)},b.$on("$destroy",function(){h.renderUnknownOption=f})}],link:function(c,e,f,k){function m(a,b,c,d){c.$render=function(){var a=null,e=c.$viewValue;angular.forEach(b.children(),function(b){return i(b).attr("value")==e?(a=i(b),!1):void 0}),d.hasOption(e)||a?(y.parent()&&y.remove(),b.val(e),a.addClass("selected").attr("selected","selected"),""===e&&p.prop("selected",!0)):h(e)&&p?b.val(""):d.renderUnknownOption(e)},e.on("mousedown",function(a){if("el-option"==a.target.tagName.toLowerCase()){var b=i(a.target);e.find("el-option").removeAttr("selected").removeClass("selected"),b.attr("selected","selected").addClass("selected"),e.val(b.attr("value")),e.triggerHandler("change"),e.triggerHandler("select")}}),b.on("change",function(){a.$apply(function(){y.parent()&&y.remove(),c.$setViewValue(b.val())})})}function n(a,b,c){var e;c.$render=function(){var a=new d(c.$viewValue);j(b.find("el-option"),function(b){b.selected=g(a.get(b.value))})},a.$watch(function(){equals(e,c.$viewValue)||(e=copy(c.$viewValue),c.$render())}),b.on("change",function(){a.$apply(function(){var a=[];j(b.find("em-option"),function(b){b.selected&&a.push(b.value)}),c.$setViewValue(a)})})}function o(c,h,j){function k(){var a,b={};s?(a=[],angular.forEach(j.$viewValue,function(c){b[p]=c,a.push(o(b))})):(b[p]=j.$viewValue,a=o(b)||(u?u.text():void 0)),c[f.displayValue]=a}function m(){k();var a,b,e,f,i,l,m,n,t,A,D,E,F,G,H,I={"":[]},J=[""],K=j.$modelValue,L=z(x),M=q?sortedKeys(L):L,N={},O=!1;if(s)if(B&&isArray(K)){O=new d([]);for(var P=0;P<K.length;P++)N[p]=K[P],O.put(B(c,N),K[P])}else O=new d(K);for(D=0;t=M.length,t>D;D++){if(m=D,q){if(m=M[D],"$"===m.charAt(0))continue;N[q]=m}if(N[p]=L[m],a=r(c,N)||"",(b=I[a])||(b=I[a]=[],J.push(a)),s)E=g(O.remove(B?B(c,N):y(c,N)));else{if(B){var Q={};Q[p]=K,E=B(c,Q)===B(c,N)}else E=K===y(c,N);O=O||E}H=o(c,N),H=g(H)?H:"",b.push({id:B?B(c,N):q?M[D]:D,label:H,selected:E})}for(s||(u||null===K?I[""].unshift({id:"",label:"",selected:!O}):O||I[""].unshift({id:"?",label:"",selected:!0})),A=0,n=J.length;n>A;A++){for(a=J[A],b=I[a],C.length<=A?(f={element:w.clone().attr("label",a),label:b.label},i=[f],C.push(i),h.append(f.element)):(i=C[A],f=i[0],f.label!=a&&f.element.attr("label",f.label=a)),F=null,D=0,t=b.length;t>D;D++)e=b[D],(l=i[D+1])?(F=l.element,l.label!==e.label&&F.text(l.label=e.label),l.id!==e.id&&F.val(l.id=e.id),l.selected!==e.selected&&(F.prop("selected",l.selected=e.selected),F.toggleClass("selected",l.selected=e.selected),F.attr("selected",l.selected=e.selected))):(""===e.id&&u?G=u:(G=v.clone()).val(e.id).toggleClass("selected",e.selected).attr("selected",e.selected).text(e.label),i.push(l={element:G,label:e.label,id:e.id,selected:e.selected}),F?F.after(G):f.element.append(G),F=G);for(D++;i.length>D;)i.pop().element.remove()}for(;C.length>A;)C.pop()[0].element.remove()}var n;if(!(n=t.match(l)))throw Exception("iexp","Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_' but got '{0}'. Element: {1}",t);var o=b(n[2]||n[1]),p=n[4]||n[6],q=n[5],r=b(n[3]||""),y=b(n[2]?n[1]:p),z=b(n[7]),A=n[8],B=A?b(n[8]):null,C=[[{element:h,label:""}]];e.on("mousedown",function(a){if("el-option"==a.target.tagName.toLowerCase()){var b=i(a.target);if(s){var c=b.attr("selected");b[c?"removeAttr":"attr"]("selected","selected"),b.toggleClass("selected",!c),b.prop("selected",!c)}else e.find("el-option").removeAttr("selected").removeClass("selected"),b.attr("selected","selected").addClass("selected`");e.val(parseInt(b.val())),e.triggerHandler("change"),e.triggerHandler("select"),k()}}),u&&(a(u)(c),u.removeClass("ng-scope"),u.remove()),h.empty(),h.on("change",function(){c.$apply(function(){var a,b,d,e,f,g,i,k,l,m=z(x),n={};if(s){for(d=[],g=0,k=C.length;k>g;g++)for(a=C[g],f=1,i=a.length;i>f;f++)if((e=a[f].element)[0].selected){if(b=e.val(),q&&(n[q]=b),B)for(l=0;l<m.length&&(n[p]=m[l],B(c,n)!=b);l++);else n[p]=m[b];d.push(y(c,n))}}else{if(b=h.val(),"?"==b)d=void 0;else if(""===b)d=null;else if(B){for(l=0;l<m.length;l++)if(n[p]=m[l],B(c,n)==b){d=y(c,n);break}}else n[p]=m[b],q&&(n[q]=b),d=y(c,n);C[0].length>1&&C[0][1].id!==b&&(C[0][1].selected=!1)}j.$setViewValue(d)})}),j.$render=m,c.$watch(m)}if(k[1]){for(var p,q=k[0],r=k[1],s=f.multiple,t=f.elOptions,u=!1,v=i("<el-option></el-option>"),w=i("<el-optgroup></el-optgroup>"),x=b(f.optionsScope)(c)||c,y=v.clone(),z=0,A=e.children(),B=A.length;B>z;z++)if(""===i(A[z]).attr("value")){p=u=A.eq(z);break}q.init(r,u,y),s&&(r.$isEmpty=function(a){return!a||0===a.length}),t?o(c,e,r):s?n(c,e,r):m(c,e,r,q)}}}}]);
//# sourceMappingURL=select-menu.min.map